



<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Entry Points &#8212; Dioptra 1.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/dioptra.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/jquery.visible.js"></script>
    <script src="../_static/jquery.leaveNotice-nist.js"></script>
    <script src="../_static/applyLeaveNotice.js"></script>
    <script src="../_static/smoothNavScroll.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user-guide/entry-points';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>

    <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
    <link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />
    <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>
    <script async type="text/javascript" id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=NIST&subagency=github&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c"></script>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">Dioptra 1.0.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    What is Dioptra?
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/building-the-containers.html">Building the Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/running-dioptra.html">Running Dioptra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/acquiring-datasets.html">Downloading Datasets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="the-web-frontend.html">The Web Frontend</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reference/task-engine-reference.html">Declarative Experiment Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api-reference-restapi.html">Testbed REST API Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/usnistgov/dioptra" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/user-guide/entry-points.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Entry Points</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-an-entry-point">What is an Entry Point?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlproject-specifications">MLproject Specifications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#executable-script">Executable Script</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-parameters">Setting Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mlflow-tracking-runs">MLFlow - Tracking Runs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prefect-task-execution">Prefect - Task Execution</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="entry-points">
<span id="user-guide-entry-points"></span><h1>Entry Points<a class="headerlink" href="#entry-points" title="Permalink to this headline">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference internal" href="../glossary.html"><span class="doc">Glossary</span></a> for the meaning of the acronyms used in this guide.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Instructions for how to create your own entry points are available in the <a class="reference internal" href="custom-entry-points.html"><span class="doc">Creating a New Entry Point guide</span></a>.</p>
</div>
<section id="what-is-an-entry-point">
<h2>What is an Entry Point?<a class="headerlink" href="#what-is-an-entry-point" title="Permalink to this headline">#</a></h2>
<figure class="align-default">
<img alt="../_images/entry-point-components.svg" src="../_images/entry-point-components.svg" /></figure>
<p>The term <em>entry point</em>, in the context of running experiment jobs, refers to executable scripts or binaries that are paired with information about their parameters.
Entry points are the fundamental unit of work within the Testbed, where each job submitted to the Testbed selects one entry point to run.
Dioptra derives its modularity in part by establishing a convention for how to compose new entry points.
The convention is identifying related units of work, for example applying one out of many evasion attacks to generate a batch of adversarial images, and then ensuring they are interchangeable with one another by implementing the corresponding executable scripts to share a common set of inputs and outputs.
This guided the construction of all the example experiments distributed as part of this project.
The <a class="reference internal" href="../glossary.html#term-SDK"><span class="xref std std-term">SDK</span></a> library and the task plugins system are both provided to help Testbed users apply this convention to their own experiments.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This particular usage for the term <em>entry point</em> <a class="reference external" href="https://mlflow.org/docs/latest/projects.html#overview">originates with the MLFlow library</a>, and we have adopted it for this project since Dioptra uses <a class="reference external" href="https://mlflow.org">MLFlow</a> on the backend to provide job tracking capabilities.</p>
</div>
<p>Each implementation of a Testbed entry point requires, at minimum, two separate files, a <a class="reference internal" href="../glossary.html#term-YAML"><span class="xref std std-term">YAML</span></a> formatted <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file, and an executable Python script that can set its internal parameters via command-line options (e.g. <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.12)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> and <a class="reference external" href="https://click.palletsprojects.com/en/8.1.x/api/#module-click" title="(in Click v8.1.x)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">click</span></code></a>).
These files are the topics of the following sections.</p>
</section>
<section id="mlproject-specifications">
<h2>MLproject Specifications<a class="headerlink" href="#mlproject-specifications" title="Permalink to this headline">#</a></h2>
<p>As was mentioned before, the <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file is a plain text file in <a class="reference internal" href="../glossary.html#term-YAML"><span class="xref std std-term">YAML</span></a> syntax that declares an entry point’s executable command and its available parameters.
An example of an <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file is below,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">My Project</span>

<span class="nt">entry_points</span><span class="p">:</span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">path</span><span class="p p-Indicator">,</span><span class="nt"> default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/nfs/data&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">image_size</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="p p-Indicator">,</span><span class="nt"> default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;28,28,1&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">python src/train.py</span>
<span class="w">      </span><span class="no">--data-dir {data_dir}</span>
<span class="w">      </span><span class="no">--image-size {image_size}</span>
<span class="w">  </span><span class="nt">infer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">run_id</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">image_size</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="p p-Indicator">,</span><span class="nt"> default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;28,28,1&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">python src/infer.py</span>
<span class="w">      </span><span class="no">--run-id {run_id}</span>
<span class="w">      </span><span class="no">--image-size {image_size}</span>
</pre></div>
</div>
<p>As we can see, there are two entry points in this <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file, <cite>train</cite> and <cite>infer</cite>.
If we submit a job that selects the <cite>train</cite> entry point and use its default parameters, we will end up running the following command in the Testbed environment,</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>src/train.py<span class="w"> </span>--data-dir<span class="w"> </span>/nfs/data<span class="w"> </span>--image-size<span class="w"> </span><span class="m">28</span>,28,1
</pre></div>
</div>
<p>Users should note that each of the declared parameters must specify a data type.
You can specify just the data type by writing the following in your <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">parameter_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data_type</span>
</pre></div>
</div>
<p>A default value, in contrast, is not required, but users are encouraged to try and provide one wherever possible.
There are two equivalent ways to specify both a data type and a default value in the <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Short syntax</span>
<span class="nt">parameter_name</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="nv">data_type</span><span class="p p-Indicator">,</span><span class="nt"> default</span><span class="p">:</span><span class="w"> </span><span class="nv">value</span><span class="p p-Indicator">}</span>

<span class="c1"># Long syntax</span>
<span class="nt">parameter_name</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data_type</span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file supports four parameter types, some of which are handled in a special way (for example, the <cite>path</cite> data type will download certain files to local storage).
Any undeclared parameters are treated as <cite>string</cite>.
The parameter types are:</p>
<dl class="simple">
<dt>string</dt><dd><p>A text string.</p>
</dd>
<dt>float</dt><dd><p>A real number.
The parameter will be checked if it is a number at runtime.</p>
</dd>
<dt>path</dt><dd><p>A path on the local file system.
Any relative <code class="docutils literal notranslate"><span class="pre">path</span></code> parameters will be converted to absolute paths.
Any paths passed as distributed storage <a class="reference internal" href="../glossary.html#term-URI"><span class="xref std std-term">URI</span></a>s (<code class="docutils literal notranslate"><span class="pre">s3://</span></code>, <code class="docutils literal notranslate"><span class="pre">dbfs://</span></code>, <code class="docutils literal notranslate"><span class="pre">gs://</span></code>, etc.) will be downloaded to local files.
Use this type for programs that can only read local files.</p>
</dd>
<dt>uri</dt><dd><p>A <a class="reference internal" href="../glossary.html#term-URI"><span class="xref std std-term">URI</span></a> for data either in a local or distributed storage system.
Relative paths are converted to absolute paths, as in the <cite>path</cite> type.
Use this type for programs that know how to read from distributed storage (e.g., programs that use the <a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/boto3.html#module-boto3" title="(in Boto3 v1.34.156)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">boto3</span></code></a> package to directly access S3 storage).</p>
</dd>
</dl>
</section>
<section id="executable-script">
<h2>Executable Script<a class="headerlink" href="#executable-script" title="Permalink to this headline">#</a></h2>
<p>The entry point script, in principle, is just an executable Python script that accepts command-line options, so Testbed users can get started quickly by using their pre-existing Python scripts.
However, if users wish to make use of the Testbed’s powerful job tracking and task plugin capabilities, they will need to adopt the Testbed’s standard for writing entry point scripts outlined in this section.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The Testbed <a class="reference internal" href="../glossary.html#term-SDK"><span class="xref std std-term">SDK</span></a>, in a planned future release, will be extending the <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> specification to facilitate the templated generation of entry point scripts.
Users will have an easier time migrating their scripts to this new approach if they follow the Testbed’s standard for entry point scripts when <a class="reference internal" href="custom-entry-points.html"><span class="doc">creating their own entry points</span></a>.</p>
</div>
<section id="setting-parameters">
<h3>Setting Parameters<a class="headerlink" href="#setting-parameters" title="Permalink to this headline">#</a></h3>
<p>The <a class="reference external" href="https://click.palletsprojects.com/en/8.1.x/api/#module-click" title="(in Click v8.1.x)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">click</span></code></a> library should be used to create command-line interfaces for their Python scripts and to convert data types that aren’t supported by the <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>, for instance).
The following is a short example based on the <cite>train</cite> entry point from the <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> examples we considered earlier in this guide,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/train.py</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">from</span> <span class="nn">dioptra.sdk.utilities.contexts</span> <span class="kn">import</span> <span class="n">plugin_dirs</span>
<span class="kn">from</span> <span class="nn">dioptra.sdk.utilities.logging</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">StderrLogStream</span><span class="p">,</span>
    <span class="n">StdoutLogStream</span><span class="p">,</span>
    <span class="n">attach_stdout_stream_handler</span><span class="p">,</span>
    <span class="n">clear_logger_handlers</span><span class="p">,</span>
    <span class="n">configure_structlog</span><span class="p">,</span>
    <span class="n">set_logging_level</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_coerce_comma_separated_ints</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--data-dir&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
        <span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dir_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readable</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Root directory for shared datasets&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--image-size&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="n">_coerce_comma_separated_ints</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Dimensions for the input images&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">image_size</span><span class="p">):</span>
    <span class="o">...</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">log_level</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DIOPTRA_JOB_LOG_LEVEL&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
    <span class="n">as_json</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DIOPTRA_JOB_LOG_AS_JSON&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="n">clear_logger_handlers</span><span class="p">(</span><span class="n">get_prefect_logger</span><span class="p">())</span>
    <span class="n">attach_stdout_stream_handler</span><span class="p">(</span><span class="n">as_json</span><span class="p">)</span>
    <span class="n">set_logging_level</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>
    <span class="n">configure_structlog</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">plugin_dirs</span><span class="p">(),</span> <span class="n">StdoutLogStream</span><span class="p">(</span><span class="n">as_json</span><span class="p">),</span> <span class="n">StderrLogStream</span><span class="p">(</span><span class="n">as_json</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">train</span><span class="p">()</span>
</pre></div>
</div>
<p>Here, Click is validating our inputs by checking if <code class="docutils literal notranslate"><span class="pre">--image-size</span></code> is passed a string and if <code class="docutils literal notranslate"><span class="pre">--data-dir</span></code> points to a directory that exists and is readable.
We also define a callback function for <code class="docutils literal notranslate"><span class="pre">--image-size</span></code> that will convert a string of comma-separated integers into a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>, i.e. transform <code class="docutils literal notranslate"><span class="pre">&quot;28,28,1&quot;</span></code> into <code class="docutils literal notranslate"><span class="pre">(28,</span> <span class="pre">28,</span> <span class="pre">1)</span></code>.
The code underneath the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;:</span></code> block at the end ensures that the <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">src/train.py</span></code> command specified in the <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file will call the <code class="docutils literal notranslate"><span class="pre">train()</span></code> function and use the values passed via the <code class="docutils literal notranslate"><span class="pre">--data-dir</span></code> and <code class="docutils literal notranslate"><span class="pre">--image-size</span></code> command-line options.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>While most of the code underneath the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;:</span></code> block is for configuring the script’s logger, the context created by <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">plugin_dirs():</span></code> plays a different and very important role, which will be discussed <a class="reference internal" href="task-plugins.html"><span class="doc">in the following guide on task plugins</span></a>.</p>
</div>
<p>This small example only scratches the surface of what Click can do.
Testbed users are encouraged to peruse the Click documentation to learn more about its features: <a class="reference external" href="https://click.palletsprojects.com/en/7.x/">https://click.palletsprojects.com/en/7.x/</a></p>
</section>
<section id="mlflow-tracking-runs">
<h3>MLFlow - Tracking Runs<a class="headerlink" href="#mlflow-tracking-runs" title="Permalink to this headline">#</a></h3>
<p>Every entry point script needs to invoke <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.start_run" title="(in MLflow v2.15.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.start_run()</span></code></a> to create an active run context for MLFlow and it should be done near the top of their entry point function.
This context is needed when logging results and artifacts to the MLFlow Tracking service.
The following example shows how this context would be started in the <code class="docutils literal notranslate"><span class="pre">train()</span></code> function from the previous section.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Truncated...</span>
<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">image_size</span><span class="p">):</span>
    <span class="c1"># Only use this when training a model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>

    <span class="c1"># Start the active run context for MLFlow</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">()</span> <span class="k">as</span> <span class="n">active_run</span><span class="p">:</span>
        <span class="n">flow</span> <span class="o">=</span> <span class="n">init_flow</span><span class="p">()</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">state</span>
</pre></div>
</div>
<p>Within this context block, the <code class="docutils literal notranslate"><span class="pre">active_run</span></code> variable will contain a <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.entities.html#mlflow.entities.Run" title="(in MLflow v2.15.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">mlflow.entities.Run</span></code></a> object that provides metadata about the run that is useful to have available.
MLFlow functions like <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_param" title="(in MLflow v2.15.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.log_param()</span></code></a>, <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_metric" title="(in MLflow v2.15.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.log_metric()</span></code></a>, and <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_artifact" title="(in MLflow v2.15.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.log_artifact()</span></code></a> will be able to infer the current run automatically and be able to log their data to the appropriate place.
Please note that the <code class="docutils literal notranslate"><span class="pre">init_flow()</span></code> function is <a class="reference internal" href="#entry-points-prefect-task-execution"><span class="std std-ref">introduced in the following section</span></a>.</p>
<p>Testbed users are encouraged to peruse the MLflow Tracking documentation to learn more about the tracking context and the kinds of things you can do when it’s active: <a class="reference external" href="https://mlflow.org/docs/latest/tracking.html">https://mlflow.org/docs/latest/tracking.html</a>.</p>
</section>
<section id="prefect-task-execution">
<span id="entry-points-prefect-task-execution"></span><h3>Prefect - Task Execution<a class="headerlink" href="#prefect-task-execution" title="Permalink to this headline">#</a></h3>
<p>The main work done within an entry point needs to use the <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code> class from the <a class="reference external" href="https://www.prefect.io">Prefect</a> library to create a context for assembling the entry point script’s task workflow.
Prefect is a modern workflow library that is aimed at helping data scientists set up task execution graphs with minimal changes to their existing code, and in Dioptra it provides a framework for wiring <a class="reference internal" href="task-plugins.html"><span class="doc">task plugins</span></a> together.
The following example shows the beginnings of a <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code> context to be run by the <code class="docutils literal notranslate"><span class="pre">train()</span></code> function in the previous section.</p>
<div class="highlight-python notranslate" id="entry-points-prefect-task-execution-code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">dioptra</span> <span class="kn">import</span> <span class="n">pyplugs</span>

<span class="n">_PLUGINS_IMPORT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dioptra_builtins&quot;</span>


<span class="k">def</span> <span class="nf">init_flow</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Flow</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">Flow</span><span class="p">(</span><span class="s2">&quot;Image Resizer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">flow</span><span class="p">:</span>
        <span class="n">data_dir</span><span class="p">,</span> <span class="n">image_size</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;data_dir&quot;</span><span class="p">),</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;image_size&quot;</span><span class="p">)</span>
        <span class="n">resize_output</span> <span class="o">=</span> <span class="n">pyplugs</span><span class="o">.</span><span class="n">call_task</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_PLUGINS_IMPORT_PATH</span><span class="si">}</span><span class="s2">.data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;images&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resize&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">training_dir</span><span class="p">,</span>
            <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>This example illustrates the requirement that all the input parameters for an entry point need to be declared as such using the <code class="xref py py-class docutils literal notranslate"><span class="pre">prefect.Parameter</span></code> class.
It also introduces us to our first task plugin call with <a class="reference internal" href="../reference/api-sdk/api-pyplugs.html#dioptra.pyplugs.call_task" title="dioptra.pyplugs.call_task"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyplugs.call_task()</span></code></a>.
The anatomy of this call will be discussed in the <a class="reference internal" href="task-plugins.html"><span class="doc">next section of the user guide</span></a>, so for now, users just need to know that this is how task plugins are used within the Testbed, and that the Testbed standard is to have <strong>all</strong> function calls within the <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code> context be invocations of <a class="reference internal" href="../reference/api-sdk/api-pyplugs.html#dioptra.pyplugs.call_task" title="dioptra.pyplugs.call_task"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyplugs.call_task()</span></code></a>.</p>
</section>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-an-entry-point">What is an Entry Point?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlproject-specifications">MLproject Specifications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#executable-script">Executable Script</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-parameters">Setting Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mlflow-tracking-runs">MLFlow - Tracking Runs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prefect-task-execution">Prefect - Task Execution</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            

          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

<footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        <div class="disclaimer">
          <strong>Disclaimer:</strong> Certain commercial equipment, instruments, or
          materials are identified in this documentation to foster understanding. Such
          identification does not imply recommendation or endorsement by the National
          Institute of Standards and Technology, nor does it imply that the materials
          or equipment identified are necessarily the best available for the purpose.
        </div>
      </p>
    </div>
</footer>
  </body>
</html>